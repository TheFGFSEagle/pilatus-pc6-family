<?xml version="1.0" encoding="UTF-8"?>
<system name="pt6a-20">
	<channel name="Propeller">
		<switch>
			<default value="1"/>
			<test logic="OR" value="0">
				propulsion/engine[0]/reverser == 1
				fcs/feather-pos-norm == 1
			</test>
			<output>propulsion/engine[0]/constant-speed-mode</output>
		</switch>
		
		<fcs_function>
			<function>
				<ifthen>
					<property>propulsion/engine/reverser</property>
					<table>
						<independentVar lookup="row">fcs/throttle-cmd-norm</independentVar>
						<tableData>
							0.28	-10.5
							0.38	-0.5
						</tableData>
					</table>
					<ifthen>
						<property>fcs/feather-pos-norm</property>
						<sum>
							<property>propulsion/engine/blade-angle</property>
							<product>
								<property>simulation/channel-dt</property>
								<value>10</value>
							</product>
						</sum>
						<property>propulsion/engine/blade-angle</property>
					</ifthen>
				</ifthen>
			</function>
			<output>propulsion/engine/blade-angle</output>
			<clipto>
				<min>-10.5</min>
				<max>86</max>
			</clipto>
		</fcs_function>
		
		<switch>
			<default value="0"/>
			<test value="1">
				fcs/advance-cmd-norm LT 0.4
			</test>
			<output>/controls/engines/engine/propeller-feather</output>
		</switch>
		
		<fcs_function>
			<function>
				<ifthen>
					<property>fcs/feather-pos-norm</property>
					<value>0</value>
					<table>
						<independentVar lookup="row">fcs/advance-cmd-norm</independentVar>
						<tableData>
							0.4	0
							1	1
						</tableData>
					</table>
				</ifthen>
			</function>
			<output>fcs/advance-pos-norm</output>
		</fcs_function>
	</channel>
	
	<channel name="Engine">		
		<switch>
			<default value="1"/>
			<test value="0" logic="AND">
				/controls/engines/engine/condition GT 0.3
				/controls/fuel/valve EQ 1
			</test>
			<output>propulsion/cutoff_cmd</output>
		</switch>
		
		<fcs_function>
			<function>
				<ifthen>
					<not><property>/controls/engines/engine/reverser</property></not>
					<table>
						<independentVar lookup="row">fcs/throttle-cmd-norm</independentVar>
						<tableData>
							0.42	0
							1		1
						</tableData>
					</table>
					<table>
						<independentVar lookup="row">fcs/throttle-cmd-norm</independentVar>
						<tableData>
							0		1
							0.3		0
						</tableData>
					</table>
				</ifthen>
			</function>
			<output>fcs/throttle-pos-norm</output>
		</fcs_function>
		
		<fcs_function>
			<function>
				<ifthen>
					<not><property>/controls/engines/engine/reverser</property></not>
					<max>
						<property>/controls/engines/engine/throttle</property>
						<value>0.4</value>
					</max>
					<min>
						<property>/controls/engines/engine/throttle</property>
						<value>0.4</value>
					</min>
				</ifthen>
			</function>
			<output>/controls/engines/engine/throttle</output>
		</fcs_function>
	</channel>
</system>
